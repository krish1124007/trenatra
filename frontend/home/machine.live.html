<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Machine Training Data Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f1f5f9;
      margin: 0;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 240px;
      background: #1e293b;
      color: #fff;
      height: 100vh;
      padding: 1rem;
      position: fixed;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sidebar-header h1 {
      font-size: 1.25rem;
      margin: 0;
    }

    .nav-menu {
      margin-top: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: #cbd5e1;
      text-decoration: none;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .nav-item.active,
    .nav-item:hover {
      background: #334155;
      color: #fff;
    }

    main {
      margin-left: 240px;
      width: calc(100% - 240px);
      padding: 2rem;
    }

    h1 {
      text-align: center;
      margin-bottom: 2rem;
      color: #1e293b;
    }

    .chart-container {
      max-width: 1000px;
      margin: auto;
    }

    canvas {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .error-message {
      text-align: center;
      color: red;
      margin-top: 2rem;
    }

    .loading-message {
      text-align: center;
      color: #64748b;
      font-weight: 500;
      margin-top: 2rem;
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        position: relative;
        height: auto;
      }

      main {
        margin-left: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>

    <aside class="sidebar">
        
        <nav class="nav-menu">
          <a href="profile.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 1 0-16 0"/></svg>
            Profile
          </a>
          <a href="machines.html" class="nav-item active">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="2" x2="9" y2="4"/><line x1="15" y1="2" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="22"/><line x1="15" y1="20" x2="15" y2="22"/><line x1="20" y1="9" x2="22" y2="9"/><line x1="20" y1="14" x2="22" y2="14"/><line x1="2" y1="9" x2="4" y2="9"/><line x1="2" y1="14" x2="4" y2="14"/></svg>
            Machines
          </a>
          <a href="add-machines.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>
            Add Machines
          </a>
          <a href="check-status.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
            Check Status
          </a>
        </nav>
      </aside>

  <main>
    <h1>ðŸ“ˆPast Machine Training Metrics</h1>

    <div class="live-chart-data">
        <canvas id="liveChart" height="100"></canvas>
    </div>
    <button></button>
    <div class="chart-container">
      <canvas id="trainingChart" height="100"></canvas>
    </div>
    <div id="errorMsg" class="error-message"></div>
    <div id="loadingMsg" class="loading-message">Loading data...</div>
  </main>

  <script>
    const id = localStorage.getItem("live_id");
    const errorMsg = document.getElementById("errorMsg");
    const loadingMsg = document.getElementById("loadingMsg");

    async function getData() {
      try {
        const res = await axios.get(`http://localhost:8000/machine/${id}`);
        const machine = res.data.data.data;

        loadingMsg.style.display = "none";

        if (!machine.machine_train_data) {
          errorMsg.textContent = "No training data available for this machine.";
          return;
        }

        const rawData = JSON.parse(machine.machine_train_data);
        if (!Array.isArray(rawData) || rawData.length === 0) {
          errorMsg.textContent = "Training data is empty or invalid.";
          return;
        }

        const labels = rawData.map((_, i) => `Sample ${i + 1}`);
        const temperature = rawData.map(d => d[0]);
        const vibration = rawData.map(d => d[1]);
        const pressure = rawData.map(d => d[2]);
        const runtime = rawData.map(d => d[3]);

        const ctx = document.getElementById('trainingChart').getContext('2d');

        new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'Temperature (Â°C)',
                data: temperature,
                borderColor: 'rgb(255, 99, 132)',
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                fill: true,
                tension: 0.4,
              },
              {
                label: 'Vibration Rate',
                data: vibration,
                borderColor: 'rgb(54, 162, 235)',
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                fill: true,
                tension: 0.4,
              },
              {
                label: 'Pressure (psi)',
                data: pressure,
                borderColor: 'rgb(255, 206, 86)',
                backgroundColor: 'rgba(255, 206, 86, 0.2)',
                fill: true,
                tension: 0.4,
              },
              {
                label: 'Working Hours',
                data: runtime,
                borderColor: 'rgb(75, 192, 192)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                fill: true,
                tension: 0.4,
              },
            ]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  boxWidth: 12,
                  color: '#333'
                }
              },
              tooltip: {
                mode: 'index',
                intersect: false
              }
            },
            scales: {
              y: {
                beginAtZero: false,
                ticks: {
                  color: '#444'
                }
              },
              x: {
                ticks: {
                  color: '#444'
                }
              }
            }
          }
        });

      } catch (error) {
        console.error("Error fetching or parsing training data:", error);
        loadingMsg.style.display = "none";
        errorMsg.textContent = "Something went wrong. Please try again later.";
      }
    }

    getData();
  </script>

</body>
</html>
